services:
  vectorstore_chunk512_overlap50:
    build:
      context: ..
      dockerfile: docker/Dockerfile.vectorstore
    container_name: vectorstore_chunk512_overlap50
    command: >
      python scripts/build_vectorstore.py
      --config /app/docker/chunkingconfigs.py
      --docs /app/data/raw/postgresql
      --chunk-size 512
      --chunk-overlap 50
      --name chunk512_overlap50
    volumes:
      # Volume for storing the resulting vector DB
      - ../vectorstores/chunk512_overlap50:/data
      # Mount the chunking config file
      - ../docker/chunkingconfigs.py:/app/docker/chunkingconfigs.py:ro
      # Mount the raw PostgreSQL docs
      - ../data/raw/postgresql:/app/data/raw/postgresql:ro
    environment:
      VECTOR_STORE_PATH: /data

  vectorstore_chunk1024_overlap100:
    build:
      context: ..
      dockerfile: docker/Dockerfile.vectorstore
    container_name: vectorstore_chunk1024_overlap100
    command: >
      python scripts/build_vectorstore.py
      --config /app/docker/chunkingconfigs.py
      --docs /app/data/raw/postgresql
      --chunk-size 1024
      --chunk-overlap 100
      --name chunk1024_overlap100
    volumes:
      - ../vectorstores/chunk1024_overlap100:/data
      - ../docker/chunkingconfigs.py:/app/docker/chunkingconfigs.py:ro
      - ../data/raw/postgresql:/app/data/raw/postgresql:ro
    environment:
      VECTOR_STORE_PATH: /data


# version: "3.9"

# services:
#   vectorstore_chunk512_overlap50:
#     build:
#       context: ..
#       dockerfile: docker/Dockerfile.vectorstore
#     container_name: vectorstore_chunk512_overlap50
#     command: >
#       python scripts/build_vectorstore.py
#       --config /app/docker/chunkingconfigs.py
#       --chunk-size 512
#       --chunk-overlap 50
#       --name chunk512_overlap50
#     volumes:
#       - ../vectorstores/chunk512_overlap50:/data
#     environment:
#       VECTOR_STORE_PATH: /data

#   vectorstore_chunk1024_overlap100:
#     build:
#       context: ..
#       dockerfile: docker/Dockerfile.vectorstore
#     container_name: vectorstore_chunk1024_overlap100
#     command: >
#       python scripts/build_vectorstore.py
#       --config /app/docker/chunkingconfigs.py
#       --chunk-size 1024
#       --chunk-overlap 100
#       --name chunk1024_overlap100
#     volumes:
#       - ../vectorstores/chunk1024_overlap100:/data
#     environment:
#       VECTOR_STORE_PATH: /data


# services:
#   app:
#     build: .
#     ports:
#       - "8000:8000"
#     volumes:
#       - ./data:/app/data
#       - ./src:/app/src
#     env_file:
#       - .env
#     depends_on:
#       - vectordb
#     # No command override needed, Dockerfile CMD will run

#   vectordb:
#     image: chromadb/chroma:latest
#     ports:
#       - "8001:8000"
#     volumes:
#       - chroma-data:/chroma/chroma
#     environment:
#       - IS_PERSISTENT=TRUE

#   notebook:
#     build: .
#     ports:
#       - "8888:8888"
#     volumes:
#       - ./notebooks:/app/notebooks
#       - ./data:/app/data
#       - ./src:/app/src
#     env_file:
#       - .env
#     command: ["jupyter", "notebook", "--ip=0.0.0.0", "--allow-root", "--NotebookApp.token=''"]

# volumes:
#   chroma-data:
